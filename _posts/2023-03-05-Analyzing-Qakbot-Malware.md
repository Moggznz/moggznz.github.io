---
layout: single
title: Analyzing Qakbot Malware
date: 3/05/2023
classes: wide
category:
  - Malware Analysis
tags:
  - Qakbot
---

## Intro
Firstly, this post is heavily inspired by [Pr0xylife](https://twitter.com/pr0xylife), [Malware Guy](https://twitter.com/themalwareguy), and [Phage](https://twitter.com/phage_nz). I've always been really interested in their analysis and the subsequent good deeds contributed to the infosec community. 

What I wanted to show here is some basic, somewhat manual malware analysis of a Qakbot malware sample. The sample was captured in the wild and submitted via [Cryptolaemus](https://twitter.com/Cryptolaemus1),which Pr0xylife also works through. The original post detailing execution flow, samples, and IOCs is here: https://twitter.com/Cryptolaemus1/status/1653433633821138947


## Setup
### VMs
I'm going to be running a couple VMs for the analysis:

1. [Flare VM](https://github.com/mandiant/flare-vm)
2. [Remnux](https://docs.remnux.org/install-distro/get-virtual-appliance)

## Sample

Browse to [Malware Bazaar](https://bazaar.abuse.ch/) and grab the sample we're after: https://bazaar.abuse.ch/sample/c974fc0afc08bd056253294691366303b58fc1a6d76fa7c6f837d3932fc049fe/

## Analysis
### PDF
The first thing we can do is take an initial look at the sample document:
{% include figure image_path="/assets/images/qbot-analysis/qbot-pdf.PNG" %}

We can see if we hover over the "OPEN" button, our first IOC in the form of hxxp://iisbeac[.]com[.]mx/cache/6440fc77eb9cc.zip. If this URL was not immediately available to us we could use another method for analyzing PDFs. There's a few tools out there, but I find this one reliable: [peepdf](https://github.com/jesparza/peepdf). I use Remnux to run this tool, here is the output when run against our sample:
{% include figure image_path="/assets/images/qbot-analysis/peepdf.PNG" %}

Peepdf allows you to analyze the objects located within the pdf, for our malicous document - we can clearly see one object containing a URI. We can then interact with that object to provide our url:
{% include figure image_path="/assets/images/qbot-analysis/Object105.PNG" %}

### .zip > .wsf
Once we have downloaded the ZIP file, we extract it to provide us with our next file in our execution flow


